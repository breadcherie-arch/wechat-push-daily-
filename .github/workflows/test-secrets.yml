name: 测试 Secrets

on: workflow_dispatch

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检查Secrets是否设置
      run: |
        echo "=== Secrets 检查 ==="
        
        # 检查每个Secret是否存在
        secrets=("CORP_ID" "AGENT_ID" "AGENT_SECRET" "OPENWEATHER_API_KEY" "DEEPSEEK_API_KEY")
        
        for secret in "${secrets[@]}"; do
          if [ -n "${{ secrets[secret] }}" ]; then
            echo "✅ $secret: 已设置 (长度: ${#{{ secrets[secret] }}})"
          else
            echo "❌ $secret: 未设置"
          fi
        done
        
        echo ""
        echo "=== 注意 ==="
        echo "出于安全原因，GitHub不会显示Secrets的具体值"
        echo "只能看到是否为空"
        
    - name: 通过环境变量测试
      env:
        CORP_ID: ${{ secrets.CORP_ID }}
        AGENT_SECRET: ${{ secrets.AGENT_SECRET }}
        OPENWEATHER_API_KEY: ${{ secrets.OPENWEATHER_API_KEY }}
      run: |
        echo "=== 环境变量测试 ==="
        echo "CORP_ID 长度: ${#CORP_ID}"
        echo "AGENT_SECRET 长度: ${#AGENT_SECRET}"
        echo "OPENWEATHER_API_KEY 长度: ${#OPENWEATHER_API_KEY}"
        
        if [ ${#CORP_ID} -gt 5 ]; then
          echo "✅ CORP_ID 看起来有效"
        else
          echo "❌ CORP_ID 可能为空或太短"
        fi
        
        if [ ${#AGENT_SECRET} -gt 10 ]; then
          echo "✅ AGENT_SECRET 看起来有效"
        else
          echo "❌ AGENT_SECRET 可能为空或太短"
        fi
        
        if [ ${#OPENWEATHER_API_KEY} -gt 20 ]; then
          echo "✅ OPENWEATHER_API_KEY 看起来有效"
        else
          echo "❌ OPENWEATHER_API_KEY 可能为空或太短"
        fi
